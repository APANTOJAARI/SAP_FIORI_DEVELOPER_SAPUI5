sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/core/BusyIndicator","sap/m/SearchField","sap/ui/model/type/String","sap/m/Token","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","./utilities","../services/oData","../services/Xsjs","../model/models"],function(e,t,o,n,i,a,r,s,l,c,p,u,d,g){"use strict";var f="1";var m={};return e.extend("com.centria.CartaPreregistro.controller.View1",{onInit:async function(){var e=this;e.aTokens="";var t={InpSociedad:"",InpRuc:"",InpAtte:"",InpImporte:"",InpFecRegistro:null,InpFecConta:null,InpCuentaCargo:"",inputClaBanAbonar:"",inputCuentaAbono:"",inputCuentaDepPla:"",inputFecApe:null,inputPlazo:"",inputFecVen:null,inputTasa:"",inputIntereses:"",inputClaBanOrigen:"",inputComision:"",inputSocBen:"",inputClaBanDestino:"",inputCodLiq:"",inputPais:"",inputCIF:"",inputBanFinal:"",inputNCuen:"",inputIBAN:"",inputSwiftBic:"",inputABA:"",inputBanIntermediario:"",inputCuentaIntermediario:"",inputSwiftIntermediario:"",inputImportDolar:"",inputTipCambio:"",inputContrValor:"",inputBancoDestino1:"",inputBancoDestino2:"",inputCuentaCCI:"",inputProveedor:"",inputPortador:"",inputDNI:"",inputClaBanCargar:""};this.getView().setModel(new o(t),"oModelDataGlobal");this.getView().setModel(new o({}),"TablaManProvExtModel");this.getView().setModel(new o({editable:true}),"oModelEditForm");let n=this.getOwnerComponent().getModel("ServiceH2HModel");this.oDataService=u.getInstance();this.oDataService.setODataSapModel(n);let i=await this.oDataService.obtenerBotones();let a={BUT1:false,BUT2:false,BUT3:false,BUT9:false,BUT4:false,BUT5:false,BUT6:false,BUT7:false,BUT8:false};if(i){for(let e=0;e<i.length;e++){let t=i[e];if(a.hasOwnProperty(t.Boton)){a[t.Boton]=t.Estado}}let e=new o(a);this.getView().setModel(e,"Botones");this.byId("formCartas").setVisible(true);this.fireAccionBoton(a)}this.setupConfig();Date.prototype.getDateWithoutTime=function(){return new Date(this.toDateString())}},onPressHome:function(e){if(this.oConstantes&&this.oConstantes.rpta){let e=this.oConstantes.rpta.sDocumentUrl;let t=e.split("#");window.location.replace(t[0])}},fireAccionBoton:function(e){let t;let o=this;for(let o in e){if(e[o]===true){t=o;break}}let n=t.slice(-1);let i=new sap.m.Button;i.data("fragmentIntent",n);let a=new sap.ui.base.Event("evtFragmento",i,{});let r=this.getOwnerComponent().getModel("ServiceH2HModel");function s(e){return new Promise(function(t,n){e.metadataLoaded().then(function(){o.onChangingMainFragment(a)})})}s(r)},setupConfig:function(){this._oSociedadInput=this._byId("idInputSociedad1");this._oAcreedorInput=this._byId("idInputAcreedor");this._oClaveBancoInput=this._byId("idInputClaveBanco");this.getView().setModel(new o({}),"TablaResultadosModel")},setFilterValuesModel:function(){let e={aSociedad:"",aClaveBancoCargar:"",aClaveBancoAbonar:""};this.getView().setModel(new o(e),"FilterValuesModel")},onLoadTablasMant:function(){let e={Filter_Cab_CciSet:[],Filter_Cab_HkontSet:[]};let t=this._oSociedadInput.getTokens().length!==0?true:false,o=this._oClaveBancoInput.getTokens().length!==0?true:false;if(t){e.Bukrs=this._oSociedadInput.getTokens()[0].getKey();e.ActCci="X"}if(o){e.Hkont=this._oClaveBancoInput.getTokens()[0].getKey();e.ActAk="X"}e.Hkont="10413800";e.ActAk="X";return e},_byId:function(e){var t=this.byId(e);if(!t){t=sap.ui.getCore().byId(e)}return t},onChangingMainFragment:function(e){this.fnLimpiar();let t=this._byId("FormElementFragmentContainer");let o=this.getOwnerComponent().getModel("ModelFragments"),n=e.getSource(),i=n.data("fragmentIntent"),a="";f=i;o.getData().Fragments.forEach(e=>{if(e.id===i){a="com.centria.CartaPreregistro.view.fragments."+e.route}});let r=sap.ui.xmlfragment(a,this);t.destroyFields();t.addField(r);o.refresh(true);sap.ui.core.BusyIndicator.show(1e3);sap.ui.core.BusyIndicator.hide()},onOpeningFragmentAnulacion:function(e){var t=this;t.getView().getModel("AnulacionDoc").setProperty("/idInputSociedad","idInputSociedad9");t.getView().getModel("AnulacionDoc").setProperty("/NumDoc","");t.getView().getModel("AnulacionDoc").setProperty("/Sociedad","");t.getView().getModel("AnulacionDoc").setProperty("/Ejercicio","");t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None");let o=this.getOwnerComponent().getModel("ModelFragments"),n=e.getSource(),i=n.data("fragmentIntent"),a="";f=i;o.getData().Fragments.forEach(e=>{if(e.id===i){a="com.centria.CartaPreregistro.view.fragments."+e.route}});let r=sap.ui.xmlfragment(a,t);if(r.length!==0){t.getView().addDependent(r)}o.refresh(true);sap.ui.core.BusyIndicator.show(1e3);sap.ui.core.BusyIndicator.hide();r.open()},onContDepPlazoRowSelection:function(e){var t=this;var o=e.getSource();var n=o.getSelectedIndex();if(n<0){return}m=o.getContextByIndex(n).getObject();m.Fvencx=p.formatDate(m.Fvenc);t.getView().getModel("TablaContDepPlazo").setProperty("/numCarta",m.NroCarta);t.getView().getModel("TablaContDepPlazo").setProperty("/fechaVenc",m.Fvencx);t.getView().getModel("TablaContDepPlazo").setProperty("/fechaContab",m.Gvfecont);t.getView().getModel("TablaContDepPlazo").setProperty("/tasaInteres",m.GcWTasa)},onOpeningFragmentContabilizacion:function(e){var t=this;t.getView().getModel("TablaContDepPlazo").setProperty("/TabContPlazo",[]);var o=this.getOwnerComponent().getModel("ServiceH2HModel");t.getView().getModel("TablaContDepPlazo").setProperty("/numCarta","");t.getView().getModel("TablaContDepPlazo").setProperty("/fechaVenc","");t.getView().getModel("TablaContDepPlazo").setProperty("/fechaContab","");t.getView().getModel("TablaContDepPlazo").setProperty("/tasaInteres","");t.getView().getModel("TablaContDepPlazo").setProperty("/StatefechaContab","None");t.getView().getModel("TablaContDepPlazo").setProperty("/StatetasaInteres","None");var n={Bukrs:"",Username:"",Tpgdes:"",Accion:"CONDPP",Formss:"TBM",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[]};sap.ui.core.BusyIndicator.show(0);o.create("/Im_CabZfir107_CabSet",n,{success:function(e){console.log(e);t.getView().getModel("TablaContDepPlazo").setProperty("/TabContPlazo",e.Im_Zfir107Cdp_02Set.results);sap.ui.core.BusyIndicator.hide();let o=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.ContabilizacionDepositoPlazo",t);t.getView().addDependent(o);o.open()},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},_onContabilizar:function(e){var t=this;var o=e.getSource();if($.isEmptyObject(m)){c.error("Seleccione un registro!!!");return}var n=t.getView().getModel("TablaContDepPlazo").getProperty("/fechaContab");var i=t.getView().getModel("TablaContDepPlazo").getProperty("/tasaInteres");if($.isEmptyObject(n)&&$.isEmptyObject(i)){t.getView().getModel("TablaContDepPlazo").setProperty("/StatefechaContab","Error");t.getView().getModel("TablaContDepPlazo").setProperty("/StatetasaInteres","Error");return}else{t.getView().getModel("TablaContDepPlazo").setProperty("/StatefechaContab","None");t.getView().getModel("TablaContDepPlazo").setProperty("/StatetasaInteres","None")}if($.isEmptyObject(n)){t.getView().getModel("TablaContDepPlazo").setProperty("/StatefechaContab","Error");return}else{t.getView().getModel("TablaContDepPlazo").setProperty("/StatefechaContab","None")}if($.isEmptyObject(i)){t.getView().getModel("TablaContDepPlazo").setProperty("/StatetasaInteres","Error");return}else{t.getView().getModel("TablaContDepPlazo").setProperty("/StatetasaInteres","None")}n=new Date(n+"T00:00:00");var a=this.getOwnerComponent().getModel("ServiceH2HModel");var r={BelnrApe:m.BelnrApe,BelnrCap:m.BelnrCap,Bldat:m.Bldat,Bukrs:m.Bukrs,Dmbtr:m.Dmbtr,Fvenc:m.Fvenc,GcWTasa:i,GjahrApe:m.GjahrApe,GjahrCap:m.GjahrCap,Gvfecont:n,Hkont1:m.Hkont1,Hkont2:m.Hkont2,Hkont3:m.Hkont3,Inter:m.Inter,NroCarta:m.NroCarta,State:m.State,Tasa:m.Tasa,Waers:m.Waers};var s={Bukrs:"",Username:"",Tpgdes:"",Accion:"CONT_DP",Formss:"TBM",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[r],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};sap.ui.core.BusyIndicator.show(0);a.create("/Im_CabZfir107_CabSet",s,{success:function(e,o){console.log(e);t._onCreateMessageView(e);sap.ui.core.BusyIndicator.hide();t.closeDialog()},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},_onAnularDocumentos:function(e){var t=this;var o=t.getView().getModel("AnulacionDoc").getProperty("/NumDoc");var n=t._byId("idInputSociedad9").getValue();var i=t.getView().getModel("AnulacionDoc").getProperty("/Ejercicio");var a;if($.isEmptyObject(t.aTokens)){a=t.aTokens}else{a=t.aTokens[0].getKey()}if($.isEmptyObject(o)&&($.isEmptyObject(n)&&$.isEmptyObject(a))&&$.isEmptyObject(i)){t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","Error");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","Error");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","Error");return}else{t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None")}if($.isEmptyObject(o)&&($.isEmptyObject(n)&&$.isEmptyObject(a))){t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None");return}else{t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None")}if($.isEmptyObject(o)&&$.isEmptyObject(i)){t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","Error");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","Error");return}else{t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None")}if($.isEmptyObject(n)&&$.isEmptyObject(a)&&$.isEmptyObject(i)){t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","Error");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","Error");return}else{t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None")}if($.isEmptyObject(o)){t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","Error");return}else{t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None")}if($.isEmptyObject(n)&&$.isEmptyObject(a)){t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","Error");return}else{t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None")}if($.isEmptyObject(i)){t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","Error");return}else{t.getView().getModel("AnulacionDoc").setProperty("/StateNumDoc","None");t.getView().getModel("AnulacionDoc").setProperty("/StateSociedad","None");t.getView().getModel("AnulacionDoc").setProperty("/StateEjercicio","None")}var r=this.getOwnerComponent().getModel("ServiceH2HModel");var s={GpBelnr:o,Gvbukrs:n,GpGjahr:i,Gvfecap:null,Gvfecvenc:null,Gvfecrg:null,Gvfeccnt:null,Gvimporte:"0.0",Gvcapint:"0.0",Gvtc:"0.0",Gvcomision:"0.0",Gvinteres:"0.0",Gvtasa:"0.0",Gvimp2:"0.0",Gvimp1:"0.0",Gvctvalor:"0.0",Gvruc:"",Gvremitente:"",Gvwaers:"",Gvplazo:"",Gvbanklo:"",Gvbankld:"",Gvbukrsben:"",Gvref:"",Gvctadepos:"",Gvcci:"",Gvctacargo:"",Gvctabono:"",GcRad5:"",GcRad2:"",Gvcta2:"",Gvbco2:"",Gvdni:"",Gvprov:"",GcHkont1:"",GcHkont2:"",GcHkont3:"",Gvnomprov:"",Gvxland1:"",Gvxname1:"",Gvxrbancinter:"",Gvxbcointer:"",Gvxswiftinter:"",Gvxctainter:"",Gvxbcofinal:"",Gvxctafinal:"",Gvxswiftbic:"",Gvxaba:"",Gvxiban:"",Gvxcif:"",Gvxliq:""};var l={Bukrs:n,Username:"",Tpgdes:"",Accion:"ANULDO",Formss:"TBM",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[s],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};sap.ui.core.BusyIndicator.show(0);r.create("/Im_CabZfir107_CabSet",l,{success:function(o,n){console.log(o);c.success(t.getI18nText("txtSuccess"));sap.ui.core.BusyIndicator.hide();t.closeDialog(e)},error:function(e){sap.ui.core.BusyIndicator.hide()}})},closeDialog:function(e){if(!$.isEmptyObject(e)){e.getSource().getParent().destroy()}else{e.getSource().getParent().close()}},createEntry:function(e,t={}){return new Promise((o,n)=>{this.getServiceModel().create("/"+e,t,{success:e=>{o(e)},error:e=>{n(e)}})})},onSociedadSearch:function(e){let t=e.getParameter("value");let o=[new s("Companycode",l.Contains,t),new s("Companycodename",l.Contains,t)];let n=new s({filters:o,and:false});let i=e.getSource().getBinding("items");i.filter([n])},onClaveBancoSearch:function(e){let t=e.getParameter("value");let o=this.getView().getModel("oModelDataGlobal");let n=o.getProperty("/InpSociedad");let i=[new s("Hbkid",l.Contains,t),new s("Banka",l.Contains,t)];let a=new s({filters:i,and:false});let r=e.getSource().getBinding("items");r.filter([a,new s("Bukrs",l.EQ,n)])},openMatchCodeClaveBanco:function(){if(!this._ClaveBancoDialog){this._ClaveBancoDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.ClaveBanco",this);this.getView().addDependent(this._ClaveBancoDialog)}let e=this.getView().getModel("oModelDataGlobal");let t=e.getProperty("/InpSociedad");if(e.getProperty("/InpSociedad")){let e=sap.ui.getCore().byId("tbsClaveBanco");let o=e.getBinding("items");o.filter([new s("Bukrs",l.EQ,t)]);this._ClaveBancoDialog.open()}else{c.information("Seleccione una sociedad")}},openMatchCodeClaveBancoDest:function(){if(!this._ClaveBancoDestDialog){this._ClaveBancoDestDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.ClaveBancoDestino",this);this.getView().addDependent(this._ClaveBancoDestDialog)}let e=this.getView().getModel("oModelDataGlobal");let t=e.getProperty("/inputSocBen");if(t){let e=sap.ui.getCore().byId("tbsClaveBancoDestino");let o=e.getBinding("items");o.filter([new s("Bukrs",l.EQ,t)]);this._ClaveBancoDestDialog.open()}else{c.information("Seleccione una sociedad beneficiaria")}},openMatchCodeSociedad:function(){if(!this._oSociedadSelectDialog){this._oSociedadSelectDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.SociedadFilter",this);this.getView().addDependent(this._oSociedadSelectDialog)}this._oSociedadSelectDialog.open()},openMatchCodeSociedadBen:function(){if(!this._oSociedadBenSelectDialog){this._oSociedadBenSelectDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.SociedadFilterBen",this);this.getView().addDependent(this._oSociedadBenSelectDialog)}this._oSociedadBenSelectDialog.open()},onValueHelpCancelPress:function(){this._oValueHelpDialog.close()},onValueHelpAfterClose:function(){this._oValueHelpDialog.destroy()},_filterTable:function(e){var t=this._oValueHelpDialog;t.getTableAsync().then(function(o){if(o.bindRows){o.getBinding("rows").filter(e)}if(o.bindItems){o.getBinding("items").filter(e)}t.update()})},onSuggestSociedad:function(e){var t=e.getParameter("suggestValue");var o=[];if(t){o.push(new s("Companycode",l.StartsWith,t.toUpperCase()))}e.getSource().getBinding("suggestionItems").filter(o)},onSociedadValueHelpOkPress:function(e){let t=e.getSource().getBinding("items");t.filter([]);let o=e.getParameter("selectedContexts");if(o&&o.length){let e=o[0].getObject();let t=this._oSociedadSelectDialog.getModel("oModelDataGlobal");if(f==="1"||f==="2"||f==="3"||f==="4"||f==="5"||f==="6"||f==="7"){if(t){t.setProperty("/InpSociedad",e.Companycode)}}else if(f==="9"){let t=this.getView().getModel("AnulacionDoc");if(t){t.setProperty("/Sociedad",e.Companycode)}}}},onSociedadValueHelpOkPressBen:function(e){let t=e.getSource().getBinding("items");t.filter([]);let o=e.getParameter("selectedContexts");if(o&&o.length){let e=o[0].getObject();let t=this._oSociedadBenSelectDialog.getModel("oModelDataGlobal");if(f==="1"||f==="2"||f==="3"||f==="4"||f==="5"||f==="6"||f==="7"){if(t){t.setProperty("/inputSocBen",e.Companycode)}}}},onClaveBancoValueHelpOkPress:function(e){let t=e.getSource().getBinding("items");t.filter([]);let o=e.getParameter("selectedContexts");if(o&&o.length){let e=o[0].getObject();let t=this.getView().getModel("oModelDataGlobal");if(f==="1"||f==="2"||f==="3"||f==="4"||f==="5"||f==="6"||f==="7"){if(t){t.setProperty("/inputClaBanOrigen",e.Hbkid)}}}},onClaveBancoDestValueHelpOkPress:function(e){let t=e.getSource().getBinding("items");t.filter([]);let o=e.getParameter("selectedContexts");if(o&&o.length){let e=o[0].getObject();let t=this.getView().getModel("oModelDataGlobal");if(f==="1"||f==="2"||f==="3"||f==="4"||f==="5"||f==="6"||f==="7"){if(t){t.setProperty("/inputClaBanDestino",e.Hbkid)}}}},getServiceModel:function(){return this.getOwnerComponent().getModel("ServiceH2HModel")},getI18nText:function(e,t=[]){return t.length>0?this.getView().getModel("i18n").getResourceBundle().getText(e,t):this.getView().getModel("i18n").getResourceBundle().getText(e)},onVisualizarCarta:function(e){var t=this.getView().getModel("oModelDataGlobal").getData();var o="VER_CARTA";console.log(t);switch(f){case"1":this.fnbutton1(o,t);break;case"2":this.fnbutton2(o,t);break;case"3":this.fnbutton3(o,t);break;case"4":this.fnbutton4(o,t);break;case"5":this.fnbutton5(o,t);break;case"6":this.fnbutton6(o,t);break;case"7":this.fnbutton7(o,t);break}},onImprimirCarta:function(e){var t=this.getView().getModel("oModelDataGlobal").getData();var o="VER_CARTA";console.log(t);switch(f){case"1":this.fnbutton1(o,t);break;case"2":this.fnbutton2(o,t);break;case"3":this.fnbutton3(o,t);break;case"4":this.fnbutton4(o,t);break;case"5":this.fnbutton5(o,t);break;case"6":this.fnbutton6(o,t);break;case"7":this.fnbutton7(o,t);break}},onGenerarAsiento:function(e){var t=this;var o=this.getView().getModel("oModelDataGlobal").getData();var n="GENERAR";console.log(o);switch(f){case"1":t.fnbutton1(n,o);break;case"2":t.fnbutton2(n,o);break;case"3":t.fnbutton3(n,o);break;case"4":t.fnbutton4(n,o);break;case"5":t.fnbutton5(n,o);break;case"6":t.fnbutton6(n,o);break;case"7":t.fnbutton7(n,o);break}},fnLimpiar:function(){var e={InpSociedad:"",InpRuc:"",InpAtte:"",InpImporte:"",InpFecRegistro:null,InpFecConta:null,InpCuentaCargo:"",inputClaBanAbonar:"",inputCuentaAbono:"",inputCuentaDepPla:"",inputFecApe:null,inputPlazo:"",inputFecVen:null,inputTasa:"",inputIntereses:"",inputClaBanOrigen:"",inputComision:"",inputSocBen:"",inputClaBanDestino:"",inputCuentaInterbancaria:"",inputCodLiq:"",inputPais:"",inputCIF:"",inputBanFinal:"",inputNCuen:"",inputIBAN:"",inputSwiftBic:"",inputABA:"",inputBanIntermediario:"",inputCuentaIntermediario:"",inputSwiftIntermediario:"",inputImportDolar:"",inputTipCambio:"",inputContrValor:"",inputBancoDestino1:"",inputBancoDestino2:"",inputCuentaCCI:"",inputProveedor:"",inputPortador:"",inputDNI:"",inputClaBanCargar:""};var t=this.getView().getModel("oModelDataGlobal");t.setData(e);t.refresh()},fnbutton1:function(e,t){var o=this;var n=o.getOwnerComponent().getModel("ServiceH2HModel");var i="/Im_107_ButSet";sap.ui.core.BusyIndicator.show(0);n.read(i,{success:function(i){var a=i.results;var r="";for(var s=1;s<8;s++){if(s==f){r=a[s-1].Tpgdes}}var l={Bukrs:t.InpSociedad,Accion:e,Tpgdes:r,Formss:"",Username:"",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};var c=o.dataSap2();c.Gvbukrs=t.InpSociedad;c.Gvruc=t.InpRuc;c.Gvremitente=t.InpAtte;c.Gvimporte=t.InpImporte;c.Gvfecrg=t.InpFecRegistro;c.Gvfeccnt=t.InpFecConta;c.Gvbanklo=t.inputClaBanCargar;c.Gvctacargo=t.InpCuentaCargo;c.Gvbankld=t.inputClaBanAbonar;c.Gvctabono=t.inputCuentaAbono;c.Gvctadepos=t.inputCuentaDepPla;c.Gvfecap=t.inputFecApe;c.Gvplazo=t.inputPlazo;c.Gvfecvenc=t.inputFecVen;c.Gvtasa=t.inputTasa===""?"0.0":t.inputTasa;c.Gvinteres=t.inputIntereses===""?"0.0":t.inputIntereses;l.Im_Zfir107For_05Set.push(c);n.create("/Im_CabZfir107_CabSet",l,{success:function(e){sap.ui.core.BusyIndicator.hide();o._onCreateMessageView(e);console.log(e)},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},fnbutton2:function(e,t){var o=this;var n=this.getOwnerComponent().getModel("ServiceH2HModel");var i="/Im_107_ButSet";var a={Bukrs:t.InpSociedad,Accion:e,Tpgdes:"BUT2",Formss:"",Username:"",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};var r=o.dataSap2();r.Gvbukrs=t.InpSociedad;r.Gvremitente=t.InpAtte;r.Gvimporte=t.InpImporte;r.Gvfecrg=t.InpFecRegistro===""?null:t.InpFecRegistro;r.Gvfeccnt=t.InpFecConta===""?null:t.InpFecConta;r.Gvbanklo=t.inputClaBanOrigen;r.Gvctacargo=t.InpCuentaCargo;r.Gvbukrsben=t.inputSocBen;r.Gvbankld=t.inputClaBanDestino;r.Gvxctainter=t.inputCuentaInterbancaria;r.Gvcomision=t.inputComision===""?"0.0":t.inputComision;a.Im_Zfir107For_05Set.push(r);sap.ui.core.BusyIndicator.show(0);n.create("/Im_CabZfir107_CabSet",a,{success:function(e){sap.ui.core.BusyIndicator.hide();o._onCreateMessageView(e);console.log(e)},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},fnbutton3:function(e,t){var o=this.getOwnerComponent().getModel("ServiceH2HModel");var n="/Im_107_ButSet";var i=this;var a={Bukrs:t.InpSociedad,Accion:e,Tpgdes:"BUT3",Formss:"",Username:"",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};var r=i.dataSap2();r.Gvbukrs=t.InpSociedad;r.Gvremitente=t.InpAtte;r.Gvimporte=t.InpImporte;r.Gvfecrg=t.InpFecRegistro===""?null:t.InpFecRegistro;r.Gvfeccnt=t.InpFecConta===""?null:t.InpFecConta;r.Gvbanklo=t.inputClaBanOrigen;r.Gvctacargo=t.InpCuentaCargo;r.Gvbukrsben=t.inputSocBen;r.Gvbankld=t.inputClaBanDestino;r.Gvctabono=t.inputCuentaAbono;r.Gvcomision=t.inputComision===""?"0.0":t.inputComision;a.Im_Zfir107For_05Set.push(r);sap.ui.core.BusyIndicator.show(0);o.create("/Im_CabZfir107_CabSet",a,{success:function(e){sap.ui.core.BusyIndicator.hide();i._onCreateMessageView(e);console.log(e)},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},fnbutton4:function(e,t){var o=this.getOwnerComponent().getModel("ServiceH2HModel");var n="/Im_107_ButSet";var i=this;var a={Bukrs:t.InpSociedad,Accion:e,Tpgdes:"BUT4",Formss:"",Username:"",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[],ImZfir107FacturasExtSet:[]};var r=i.dataSap2();r.Gvbukrs=t.InpSociedad;r.Gvprov=t.inputProveedor;r.Gvimporte=t.InpImporte;r.Gvfecrg=t.InpFecRegistro===""?null:t.InpFecRegistro;r.Gvfeccnt=t.InpFecConta===""?null:t.InpFecConta;r.Gvxliq=t.inputCodLiq;r.Gvbanklo=t.inputClaBanOrigen;r.Gvctacargo=t.InpCuentaCargo;r.Gvbukrsben=t.inputSocBen;r.Gvxland1=t.inputPais;r.Gvxcif=t.inputCIF;r.Gvxbcofinal=t.inputBanFinal;r.Gvxctafinal=t.inputNCuen;r.Gvxiban=t.inputIBAN;r.Gvxswiftbic=t.inputSwiftBic;r.Gvxaba=t.inputABA;r.Gvxbcointer=t.inputBanIntermediario;r.Gvxctainter=t.inputCuentaIntermediario;r.Gvxswiftinter=t.inputSwiftIntermediario;a.Im_Zfir107For_05Set.push(r);sap.ui.core.BusyIndicator.show(0);o.create("/Im_CabZfir107_CabSet",a,{success:function(e){sap.ui.core.BusyIndicator.hide();i._fnMostrarFacturas(e);console.log(e)},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},fnbutton5:function(e,t){var o=this.getOwnerComponent().getModel("ServiceH2HModel");var n="/Im_107_ButSet";var i=this;o.read(n,{success:function(n){var a=n.results;var r="";for(var s=1;s<8;s++){if(s==f){r=a[s-1].Tpgdes}}var l={Bukrs:t.InpSociedad,Accion:e,Tpgdes:r,Formss:"",Username:"",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};var c=i.dataSap2();c.Gvbukrs=t.InpSociedad;c.Gvremitente=t.InpAtte;c.Gvimporte=t.inputImportDolar;c.Gvfecrg=t.InpFecRegistro===""?null:t.InpFecRegistro;c.Gvfeccnt=t.InpFecConta===""?null:t.InpFecConta;c.Gvtc=t.inputTipCambio;c.Gvctvalor=t.inputContrValor;c.Gvbanklo=t.inputClaBanOrigen;c.Gvctacargo=t.InpCuentaCargo;c.Gvbankld=t.inputClaBanDestino;c.Gvctabono=t.inputCuentaAbono;l.Im_Zfir107For_05Set.push(c);o.create("/Im_CabZfir107_CabSet",l,{success:function(e){i._onCreateMessageView(e);console.log(e)},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})},fnbutton6:function(e,t){var o=this.getOwnerComponent().getModel("ServiceH2HModel");var n="/Im_107_ButSet";var i=this;o.read(n,{success:function(n){var a=n.results;var r="";for(var s=1;s<8;s++){if(s==f){r=a[s-1].Tpgdes}}var l={Bukrs:t.InpSociedad,Accion:e,Tpgdes:r,Formss:"",Username:"",Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};var c=i.dataSap2();c.Gvbukrs=t.InpSociedad;c.Gvremitente=t.InpAtte;c.Gvimporte=t.InpImporte;c.Gvfecrg=t.InpFecRegistro===""?null:t.InpFecRegistro;c.Gvfeccnt=t.InpFecConta===""?null:t.InpFecConta;c.Gvtc=t.inputTipCambio;c.Gvctvalor=t.inputContrValor;c.Gvbanklo=t.inputClaBanOrigen;c.Gvctacargo=t.InpCuentaCargo;c.Gvbankld=t.inputClaBanDestino;c.Gvctabono=t.inputCuentaAbono;c.Gvxbcofinal=t.inputBancoDestino2;c.Gvcci=t.inputCuentaCCI;l.Im_Zfir107For_05Set.push(c);o.create("/Im_CabZfir107_CabSet",l,{success:function(e){i._onCreateMessageView(e);console.log(e)},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})},fnbutton7:function(e,t){var o=this.getOwnerComponent().getModel("ServiceH2HModel");var n="/Im_107_ButSet";var i=this;o.read(n,{success:function(n){var a=n.results;var r="";for(var s=1;s<8;s++){if(s==f){r=a[s-1].Tpgdes}}var l={Bukrs:t.InpSociedad,Accion:e,Bottom:r,Im_Zfir107Bin_07Set:[],Im_Zfir107Cbp_01Set:[],Im_Zfir107Cdp_02Set:[],Im_Zfir107Cib_04Set:[],Im_Zfir107For_05Set:[],Im_Zfir107Mdp_03Set:[],Im_Zfir107Mtp_06Set:[],Im_Zfir107Log_08Set:[]};var c=i.dataSap2();c.Gvbukrs=t.InpSociedad;c.Gvprov=t.inputProveedor;c.Gvxname1=t.inputPortador;c.Gvdni=t.inputDNI;c.Gvimporte=t.InpImporte;c.Gvfecrg=t.InpFecRegistro===""?null:t.InpFecRegistro;c.Gvfeccnt=t.InpFecConta===""?null:t.InpFecConta;c.Gvtc=t.inputTipCambio;c.Gvctvalor=t.inputContrValor;c.Gvbanklo=t.inputClaBanCargar;c.Gvctacargo=t.InpCuentaCargo;l.Im_Zfir107For_05Set.push(c);o.create("/Im_CabZfir107_CabSet",l,{success:function(e){i._onCreateMessageView(e);console.log(e)},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})},dataSap2:function(){var e={Gvbukrs:"",Gvruc:"",Gvremitente:"",Gvwaers:"",Gvimporte:"0.0",Gvcapint:"0.0",Gvplazo:"",Gvbanklo:"",Gvbankld:"",Gvbukrsben:"",Gvtc:"0.0",Gvref:"",Gvcomision:"0.0",Gvctadepos:"",Gvinteres:"0.0",Gvtasa:"0.0",Gvcci:"",Gvctacargo:"",Gvctabono:"",GcRad5:"",GcRad2:"",Gvcta2:"",Gvbco2:"",Gvimp2:"0.0",Gvimp1:"0.0",Gvctvalor:"0.0",Gvdni:"",Gvprov:"",GcHkont1:"",GcHkont2:"",GcHkont3:"",Gvnomprov:"",Gvxland1:"",Gvxname1:"",Gvxrbancinter:"",Gvxbcointer:"",Gvxswiftinter:"",Gvxctainter:"",Gvxbcofinal:"",Gvxctafinal:"",Gvxswiftbic:"",Gvxaba:"",Gvxiban:"",Gvxcif:"",Gvxliq:"",Gvfecrg:null,Gvfeccnt:null,GpBelnr:"",GpGjahr:"",Gvfecap:null,Gvfecvenc:null};return e},dataSap:function(){var e={Action:"",Bottom:"",Switch:"",Dolares:"",Pagos:"",Bukrs:"0011",Provee:"",Dprove:"",Ruc:"",Referencia:"",Dni:"",Importe:"",Fecregist:"",Feccontab:"",Waers:"",Codliquid:"",Tipocambio:"",Contravalor:"",Banklo:"",Cuentacargo:"",Bukrsbenef:"",Bankld:"",Bankdest:"",Cuentabono:"",Cuentacci:"",Imp1:"",Imp2:"",Cuentadeposito:"",Cuentaccidespo:"",Fecapertura:"",Plazodias:"",Fecvencimie:"",Tasa:"",Intereses:"",Comision:"",Remuneracion:"",Motivotransp:"",Pais:"",Cif:"",Bancofinal:"",Cuentafinal:"",Iban:"",Swift:"",Aba:"",Bancointerm:"",Cuentainterm:"",Swiftinterm:""};return e},onOpeningFragmentVisulaizarCartaVista:function(){let e=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.VisulaizarCartaVista",this);this.getView().addDependent(e);e.open()},onOpeningFragmentImprimirCartaVista:function(){let e=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.ImprimirCartaVista",this);this.getView().addDependent(e);e.open()},onOpeningFragmentGenerarAsientoVista:function(){let e=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.GenerarAsientoVista",this);this.getView().addDependent(e);e.open()},openFragmentMantProv:function(){let e=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.ManProvExt",this);this.getView().addDependent(e);let t=this.getOwnerComponent().getModel("ServiceH2HModel");let o=this._byId("stProveedores");o.setModel(t);e.open()},openFragmentMantCtaInt:function(){let e=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.CCI",this);this.getView().addDependent(e);let t=this.getOwnerComponent().getModel("ServiceH2HModel");let o=this._byId("stCCI");o.setModel(t);e.open()},openFragmentDepositos:function(){let e=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.Depositos",this);this.getView().addDependent(e);let t=this.getOwnerComponent().getModel("ServiceH2HModel");let o=this._byId("stDepoPlazo");o.setModel(t);e.open()},_onChangeDateRangeSelection:function(){var e=this;e.getView().getModel("TablaContDepPlazo").setProperty("/StatefechaContab","None")},openAcreedores:function(e){let t=[];let o=this.getView().getModel("oModelDataGlobal").getData().InpSociedad;if(!o||!o.trim().length){c.information(this.getI18nText("validacionSociedad"));return false}if(!this._oProveedorSelectDialog){this._oProveedorSelectDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.Acreedor",this);this.getView().addDependent(this._oProveedorSelectDialog)}let n=this._byId("tbsProveedor");let i=n.getBinding("items");i.filter([new s("Companycode",l.EQ,o)]);this._oProveedorSelectDialog.open()},onAddProveedor:function(e){let t=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.ProveedorFormulario",this);this.getView().addDependent(t);let o=this.getOwnerComponent().getModel("ServiceH2HModel");let n=this.getView().getModel("oModelEditForm");n.setProperty("/editable",true);let i=this._byId("dialogProveedor");let a=this._byId("fmProveedor");i.setTitle("Nuevo Proveedor Externo");a.setModel(o);let r=o.createEntry("/ProveedorExternoSet");a.setBindingContext(r);t.open()},onEditProveedor:function(e){let t=this._byId("stProveedores").getTable();let o=t.getSelectedItem();if(!o){c.information("Debe seleccionar un registro");return false}let n=o.getBindingContext();let i=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.ProveedorFormulario",this);this.getView().addDependent(i);let a=this.getOwnerComponent().getModel("ServiceH2HModel");let r=this.getView().getModel("oModelEditForm");r.setProperty("/editable",false);let s=this._byId("dialogProveedor");let l=this._byId("fmProveedor");s.setTitle("Editar Proveedor Externo");l.setModel(a);l.setBindingContext(n);i.open()},_fnCheckRespuesta:function(e){let t=true;for(let o=0;o<e.length;o++){let n=e[o];if(n.message==="HTTP request failed"){t=false;break}}return t},onLiveChangeInput:function(e){let t=e.getSource();t.setValueState("None")},onDeleteProveedor:function(e){let t=this;let o=sap.ui.getCore().byId("stProveedores");let n=o.getTable();let i=n.getSelectedItem();if(i){let e=i.getBindingContext();let n=e.getPath();let a=e.getObject();c.show("¿Desea eliminar el proveedor "+a.Lifnr+"-"+a.Name1+" ?",{icon:sap.m.MessageBox.Icon.INFORMATION,title:"Eliminar Provededor",actions:["Sí","Cancelar"],onClose:async function(e){if(e==="Sí"){let e=await t.oDataService.eliminarEntidadSAP(n);o.rebindTable();c.success("Registro eliminado correctamente")}}})}else{c.information("Debe seleccionar un registro")}},onProveedorSearch:function(e){let t=e.getParameter("value");let o=this.getView().getModel("oModelDataGlobal").getData().InpSociedad;let n=[new s("Supplier",l.Contains,t),new s("Suppliername",l.Contains,t),new s("Taxnumber1",l.Contains,t)];let i=new s({filters:n,and:false});let a=e.getSource().getBinding("items");a.filter([i,new s("Companycode",l.EQ,o)])},onAcreedorValueHelpOkPress:function(e){let t=e.getSource().getBinding("items");t.filter([]);let o=e.getParameter("selectedContexts");if(o&&o.length){let e=o[0].getObject();let t=this._oProveedorSelectDialog.getModel("oModelDataGlobal");if(f==="4"||f==="7"){if(t){t.setProperty("/inputProveedor",e.Supplier)}}}},openFragmentAcreedores:function(e){n.show();let t=this.getView().getModel("MatchModel");var o=this.getView().getModel("oModelDataGlobal").getData();if(o.InpSociedad){this.openAcreedores().then(e=>{let o=this.oColModelAcreedor.getData().cols;this._oBasicSearchField=new i({showSearchButton:false});this._oValueHelpDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.fragments.Acreedor",this);this.getView().addDependent(this._oValueHelpDialog);this._oValueHelpDialog.setRangeKeyFields([{label:"Código",key:"Lifnr",type:"string",typeInstance:new a({},{maxLength:20})}]);var r=this._oValueHelpDialog.getFilterBar();r.setFilterBarExpanded(false);r.setBasicSearch(this._oBasicSearchField);this._oValueHelpDialog.getTableAsync().then(function(e){e.setModel(t);e.setModel(this.oColModelAcreedor,"columns");if(e.bindRows){e.bindAggregation("rows","MatchModel>/acreedores")}if(e.bindItems){e.bindAggregation("items","MatchModel>/acreedores",function(){return new ColumnListItem({cells:o.map(function(e){return new Label({text:"{"+e.template+"}"})})})})}this._oValueHelpDialog.update();n.hide()}.bind(this));this._oAcreedorInput=this._byId("idInputAcreedor"+f);this._oValueHelpDialog.setTokens(this._oAcreedorInput.getTokens());this._oValueHelpDialog.open()})}else{c.error("Debe seleccionar una sociedad previamente");n.hide()}},_onCreateMessageView:function(e){var t=this;var n=new sap.m.MessageItem({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}"});var i=[];e.Im_Zfir107Log_08Set.results.forEach(function(e){if(e.Type==="E"){e.title="Error Mensaje";e.Type="Error"}else if(e.Type==="W"){e.title="Advertencia Mensaje";e.Type="Warning"}else{e.title="Exitoso Mensaje";e.Type="Success"}var t={type:e.Type,title:e.Message,description:e.Message,subtitle:e.MessageV1,counter:1};i.push(t)});var a=new o,t=this;a.setData(i);this.oMessageView=new sap.m.MessageView({showDetailsPageHeader:false,itemSelect:function(){r.setVisible(true)},items:{path:"/",template:n}});var r=new sap.m.Button({icon:"sap-icon://nav-back",visible:false,press:function(){t.oMessageView.navigateBack();if(t._oPopover){t._oPopover.focus()}this.setVisible(false)}});this.oMessageView.setModel(a);var s=new sap.m.Button({text:"Close",press:function(){t._oPopover.close()}}),l=new sap.m.Bar({contentRight:s}),c=new sap.m.Bar({contentLeft:[r],contentMiddle:[new Text({text:"Messages"})]});this.oDialogMessage=new sap.m.Dialog({resizable:true,content:this.oMessageView,beginButton:new sap.m.Button({press:function(){if(e.Im_Zfir107Bin_07Set.results.length>0){t._onGenerarPDF(e.Im_Zfir107Bin_07Set.results)}this.getParent().close()},text:"Close"}),customHeader:new sap.m.Bar({contentMiddle:[new sap.m.Text({text:"Log"})],contentLeft:[r]}),contentHeight:"35%",contentWidth:"35%",verticalScrolling:false});this.oMessageView.navigateBack();this.oDialogMessage.open()},createUrlForPDF:function(e){var t=this;if(e===""){c.error(t.getI18nText("txtNoData"));return}var o=atob(e);var n=new Uint8Array(o.length);for(var i=0;i<o.length;i++){n[i]=o.charCodeAt(i)}var a=new Blob([n.buffer],{type:"application/pdf"});var r=URL.createObjectURL(a);jQuery.sap.addUrlWhitelist("BLOB");return r},_onGenerarPDF:function(e){let t="com.centria.CartaPreregistro.view.fragments.VisorPDF";let n=sap.ui.xmlfragment(t,this);if(n.length!==0){this.getView().addDependent(n)}var i={};i.Source=this.createUrlForPDF(e[0].Zform);i.Height="800px";i.Title="";this.getView().setModel(new o(i),"oModelPDF");sap.ui.core.BusyIndicator.show(1e3);sap.ui.core.BusyIndicator.hide();n.open()},onOpenPDFDialog:function(e){this._oPDFDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.DescargaPDF",this);this.getView().addDependent(this._oPDFDialog);let t;if(f==="4"){t="9"}else{t=f}let n=new o({Botonopc:t});this._oPDFDialog.setModel(n,"oModelPropPDF");this._oPDFDialog.open()},onMostrarPDF:async function(e){let t=this._oPDFDialog.getModel("oModelPropPDF");let o=t.getData();if(!o.Bukrs||!o.Bukrs.length||!o.Laufi||!o.Laufi.length||!o.Laufd){c.error("Debe completar los campos obligatorios")}o.Botonopc="BUT"+o.Botonopc;o.Bukrs=o.Bukrs.toUpperCase();o.Laufi=o.Laufi.toUpperCase();o.Laufd=o.Laufd.getDateWithoutTime();let n=await this.oDataService.obtenerPDFCarta(o);if(n&&n.results&&n.results.length){let e=n.results;this._onGenerarPDF(e);this._oPDFDialog.close()}},onAutoCompletar:async function(e){let t=this.getView().getModel("oModelDataGlobal");let o,n;if(f!=="4"){o=f;n={Botonopc:"BUT"+o,Bukrs:t.getProperty("/InpSociedad"),Bankl:t.getProperty("/inputClaBanOrigen"),Bukrsben:t.getProperty("/inputSocBen"),Banklben:t.getProperty("/inputClaBanDestino")}}else{o="9";n={Botonopc:"BUT"+o,Bukrs:t.getProperty("/InpSociedad"),Bankl:t.getProperty("/inputClaBanOrigen"),Gvprov:t.getProperty("/inputProveedor")}}let i=await this.oDataService.fnAutocompletarCampos(n,o);if(i&&i.results&&i.results.length){let e=i.results[0];t.setProperty("/InpCuentaCargo",e.Ctacargo);t.setProperty("/inputCuentaInterbancaria",e.Ctacci);t.setProperty("/inputCuentaAbono",e.Ctaabono);t.setProperty("/Gvnomprov",e.Gvnomprov);t.setProperty("/inputABA",e.Gvxaba);t.setProperty("/inputBanFinal",e.Gvxbcofinal);t.setProperty("/inputBanIntermediario",e.Gvxbcointer);t.setProperty("/inputCIF",e.Gvxcif);t.setProperty("/inputNCuen",e.Gvxctafinal);t.setProperty("/inputCuentaIntermediario",e.Gvxctainter);t.setProperty("/inputIBAN",e.Gvxiban);t.setProperty("/inputPais",e.Gvxland1);t.setProperty("/inputSwiftBic",e.Gvxswiftbic);t.setProperty("/inputSwiftIntermediario",e.Gvxswiftinter)}},_fnMostrarFacturas:function(e){let t=e.ImZfir107FacturasExtSet;if(t&&t.results&&t.results.length){let n=new o(e);this.getView().setModel(n,"oModelRespuesta");let i=0,a=0;for(let e=0;e<t.results.length;e++){let o=t.results[e];i+=parseFloat(o.Dmbtr);a+=parseFloat(o.Wrbtr)}let r=new o({Dmbtr:i,Wrbtr:a});this.getView().setModel(r,"oModelTotal");this._oFacturasDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.Facturas",this);this.getView().addDependent(this._oFacturasDialog);this._oFacturasDialog.open()}},onGenerarTransExt:function(e){let t=this;let o=this.getOwnerComponent().getModel("ServiceH2HModel");let n=this._byId("tbFacturasExt");let i=n.getSelectedItems();if(!i.length){c.error("Debe seleccionar al menos una factura");return false}let a=[];for(let e=0;e<i.length;e++){let t=i[e].getBindingContext("oModelRespuesta");if(t){let e=t.getObject();e.Opc="X";a.push(e)}}let r=this.getView().getModel("oModelRespuesta");let s=r.getData();s.Accion="GENECAREXT";s.Im_Zfir107Bin_07Set=[];s.Im_Zfir107Cbp_01Set=[];s.Im_Zfir107Cdp_02Set=[];s.Im_Zfir107Cib_04Set=[];s.Im_Zfir107For_05Set=s.Im_Zfir107For_05Set.results;s.Im_Zfir107Mdp_03Set=[];s.Im_Zfir107Mtp_06Set=[];s.Im_Zfir107Log_08Set=[];s.ImZfir107FacturasExtSet=a;sap.ui.core.BusyIndicator.show(0);o.create("/Im_CabZfir107_CabSet",s,{success:function(e){sap.ui.core.BusyIndicator.hide();if(t._oFacturasDialog){t._oFacturasDialog.destroy()}t._onCreateMessageView(e);console.log(e)},error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e)}})},onRefreshTabla:function(e){let t=e.getSource().getParent().getParent();t.rebindTable()},onAddCCI:function(e){let t=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.CCIFormulario",this);this.getView().addDependent(t);let o=this.getOwnerComponent().getModel("ServiceH2HModel");let n=this.getView().getModel("oModelEditForm");n.setProperty("/editable",true);let i=this._byId("dialogCCI");let a=this._byId("fmCCI");i.setTitle("Nueva Cta. Interbancaria");a.setModel(o);let r=o.createEntry("/CuentaInterbancariaSet");a.setBindingContext(r);t.open()},onEditCCI:function(e){let t=this._byId("stCCI").getTable();let o=t.getSelectedItem();if(!o){c.information("Debe seleccionar un registro");return false}let n=o.getBindingContext();let i=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.CCIFormulario",this);this.getView().addDependent(i);let a=this.getOwnerComponent().getModel("ServiceH2HModel");let r=this.getView().getModel("oModelEditForm");r.setProperty("/editable",false);let s=this._byId("dialogCCI");let l=this._byId("fmCCI");s.setTitle("Editar Cta. Interbancaria");l.setModel(a);l.setBindingContext(n);i.open()},onDeleteCCI:function(e){let t=this;let o=sap.ui.getCore().byId("stCCI");let n=o.getTable();let i=n.getSelectedItem();if(i){let e=i.getBindingContext();let n=e.getPath();let a=e.getObject();c.show("¿Desea eliminar la cuenta "+a.Bukrs+"-"+a.Hbkid+"-"+a.Bankni+" ?",{icon:sap.m.MessageBox.Icon.INFORMATION,title:"Eliminar Cta. Interbancaria",actions:["Sí","Cancelar"],onClose:async function(e){if(e==="Sí"){let e=await t.oDataService.eliminarEntidadSAP(n);o.rebindTable();c.success("Registro eliminado correctamente")}}})}else{c.information("Debe seleccionar un registro")}},onAddDeposito:function(e){let t=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.DepositoFormulario",this);this.getView().addDependent(t);let o=this.getOwnerComponent().getModel("ServiceH2HModel");let n=this.getView().getModel("oModelEditForm");n.setProperty("/editable",true);let i=this._byId("dialogDeposito");let a=this._byId("fmDeposito");i.setTitle("Nueva Cta. Depósito");a.setModel(o);let r=o.createEntry("/CuentaDepPlazoSet");a.setBindingContext(r);t.open()},onEditDeposito:function(e){let t=this._byId("stDepoPlazo").getTable();let o=t.getSelectedItem();if(!o){c.information("Debe seleccionar un registro");return false}let n=o.getBindingContext();let i=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.DepositoFormulario",this);this.getView().addDependent(i);let a=this.getOwnerComponent().getModel("ServiceH2HModel");let r=this.getView().getModel("oModelEditForm");r.setProperty("/editable",false);let s=this._byId("dialogDeposito");let l=this._byId("fmDeposito");s.setTitle("Editar Cta. Depósito");l.setModel(a);l.setBindingContext(n);i.open()},onDeleteDeposito:function(e){let t=this;let o=sap.ui.getCore().byId("stDepoPlazo");let n=o.getTable();let i=n.getSelectedItem();if(i){let e=i.getBindingContext();let n=e.getPath();let a=e.getObject();c.show("¿Desea eliminar la cuenta "+a.Hkont+"-"+a.Txt50+"-"+a.Bankl+" ?",{icon:sap.m.MessageBox.Icon.INFORMATION,title:"Eliminar Cta. Depósito",actions:["Sí","Cancelar"],onClose:async function(e){if(e==="Sí"){let e=await t.oDataService.eliminarEntidadSAP(n);o.rebindTable();c.success("Registro eliminado correctamente")}}})}else{c.information("Debe seleccionar un registro")}},closeFormMant:function(e){let t=e.getSource();let o=t.getParent();let n=t.data("form");let i=this._byId(n);let a=i.getBindingContext();let r=this.getOwnerComponent().getModel("ServiceH2HModel");r.deleteCreatedEntry(a);o.destroy()},onSaveEntidad:function(e){let t=this;let o=e.getSource();let i=o.data("tabla");let a=o.getParent();let r=this.getOwnerComponent().getModel("ServiceH2HModel");let s=this._byId(i);n.show(0);r.submitChanges({success:function(e){n.hide();let o=t._fnCheckRespuesta(e.__batchResponses);if(o){c.success("Operación exitosa");s.rebindTable();a.destroy()}}})},onRegularizarCarta:function(e){this._oReguDialog=sap.ui.xmlfragment("com.centria.CartaPreregistro.view.dialogs.RegularizarCarta",this);this.getView().addDependent(this._oReguDialog);let t=new o({});this._oReguDialog.setModel(t,"oModelPropReg");this._oReguDialog.open()},onRegularizar:async function(e){let t=this._oReguDialog.getModel("oModelPropReg");let o=t.getData();if(!o.Bukrs||!o.Laufi||!o.Laufd||!o.Budat||!o.Importe){c.error("Complete los campos obligatorios");return false}let n=[new s("Bukrs","EQ",o.Bukrs.toUpperCase()),new s("Laufi","EQ",o.Laufi.toUpperCase()),new s("Laufd","EQ",o.Laufd),new s("Budat","EQ",o.Budat),new s("Importe","EQ",o.Importe.toString()),new s("Liquid","EQ",o.Liquid)];let i=await this.oDataService.readEntidadSAP("/ReguCartaExtZFIR107Set",n);if(i){this._onCreateMessageViewAux(i)}},_onCreateMessageViewAux:function(e){var t=this;var n=new sap.m.MessageItem({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}"});var i=[];e.results.forEach(function(e){if(e.Mtype==="E"){e.title="Error Mensaje";e.Type="Error"}else if(e.Mtype==="W"){e.title="Advertencia Mensaje";e.Type="Warning"}else{e.title="Mensaje Exitoso";e.Type="Success"}var t={type:e.Type,title:e.Message,subtitle:e.MessageV1,counter:1};i.push(t)});var a=new o,t=this;a.setData(i);this.oMessageView=new sap.m.MessageView({showDetailsPageHeader:false,itemSelect:function(){r.setVisible(true)},items:{path:"/",template:n}});var r=new sap.m.Button({icon:"sap-icon://nav-back",visible:false,press:function(){t.oMessageView.navigateBack();if(t._oPopover){t._oPopover.focus()}this.setVisible(false)}});this.oMessageView.setModel(a);var s=new sap.m.Button({text:"Close",press:function(){t._oPopover.close()}}),l=new sap.m.Bar({contentRight:s}),c=new sap.m.Bar({contentLeft:[r],contentMiddle:[new Text({text:"Messages"})]});this.oDialogMessage=new sap.m.Dialog({resizable:true,content:this.oMessageView,beginButton:new sap.m.Button({press:function(){this.getParent().close()},text:"Close"}),customHeader:new sap.m.Bar({contentMiddle:[new sap.m.Text({text:"Log"})],contentLeft:[r]}),contentHeight:"25%",contentWidth:"25%",verticalScrolling:false});this.oMessageView.navigateBack();this.oDialogMessage.open()}})});