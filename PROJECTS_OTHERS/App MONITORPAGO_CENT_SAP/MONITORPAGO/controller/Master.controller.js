sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/table/RowAction","sap/ui/table/RowActionItem","sap/ui/core/BusyIndicator","../service/MonitorRPA.service","sap/ui/Device","../model/models","sap/m/MessageBox"],function(e,t,s,a,o,n,i,r,l){"use strict";return e.extend("h2h.centria.h2hmonitorpagosrpa.controller.Master",{onInit:async function(){this.getRouter().getRoute("master").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){},onPressHome:function(e){if(this.oConstantes&&this.oConstantes.rpta){let e=this.oConstantes.rpta.sDocumentUrl;let t=e.split("#");window.location.replace(t[0])}},onBeforeShow:function(e){$(document).ready(function(){$('[id*="shell-header"]').hide()})},onRowNavActionPress:function(e){this._showDetail(e.getParameter("row")||e.getSource())},onGeneratePaymentProposalPress:function(e){let t=this.byId("stPagosRPA").getTable();let s=t.getSelectedIndices();if(s.length>0){let e=s.map(e=>t.getContextByIndex(e).getObject());const a=e.map(({__metadata:e,...t})=>({...t,Check:"X"}));this.showApproveDialog("Confirmar Generación","Se generará una propuesta de pago a partir de los asientos de pago seleccionados, desea continuar?",{items:a},this._generatePaymentProposal.bind(this))}else{this.showMessageBox("warning","Advertencia","Para generar una propuesta de pago necesita seleccionar uno o más asientos de pago")}},onDeletePaymentSeatPress:function(e){let t=this.byId("stPagosRPA").getTable();let s=t.getSelectedIndices();if(s.length>0){let e=s.map(e=>t.getContextByIndex(e).getObject());const a=e.map(({__metadata:e,...t})=>({...t,Check:"X"}));this.showApproveDialog("Confirmar Eliminación","Se eliminarán los asientos de pago seleccionados, desea continuar?",{items:a},this._deletePaymentSeats.bind(this))}else{this.showMessageBox("warning","Advertencia","Para eliminar asientos de pago necesita seleccionar uno o mas registros de la tabla")}},onDeletePaymentProposalPress:function(e){let t=this.byId("stPropPagosRPA").getTable();let s=t.getSelectedIndices();if(s.length>0){let e=s.map(e=>t.getContextByIndex(e).getObject());const a=e.map(({__metadata:e,...t})=>({...t,Check:"X"}));this.showApproveDialog("Confirmar Eliminación","Se eliminarán las propuestas de pago seleccionadas, desea continuar?",{items:a},this._deletePaymentProposals.bind(this))}else{this.showMessageBox("warning","Advertencia","Para eliminar asientos de pago necesita seleccionar uno o mas registros de la tabla")}},_showDetail:function(e){let t=!i.system.phone;this.getAppModel("appModel").setProperty("/layout","TwoColumnsBeginExpanded");let s=e.getBindingContext();let a=s.getProperty("Laufd");let o=s.getProperty("Laufi");let n=s.getProperty("Bukrs");let r=a.getUTCMonth()+1;let l=`${a.getUTCDate()}-${r<10?"0"+r:r}-${a.getUTCFullYear()}`;this.getRouter().navTo("detail",{proposalDate:l,companyCode:n,proposalCode:o},t)},_generatePaymentProposal:function(e){o.show(0);let t=this.byId("stPropPagosRPA");let s=this.byId("stPagosRPA");n.triggerRequest(this.getAppModel(),e,"GENE_PROPAGO").then(e=>{o.hide();t.rebindTable(true);s.rebindTable(true);this.showMessageToast(e.message||"Propuesta de pago generada")}).catch(e=>{o.hide();this.showMessageBox("error","Error",e.message)})},_deletePaymentProposals:function(e){o.show(0);let t=this.byId("stPropPagosRPA");let s=this.byId("stPagosRPA");n.triggerRequest(this.getAppModel(),e,"ANUL_PROPAGO").then(e=>{o.hide();t.rebindTable(true);s.rebindTable(true);this.showMessageToast(e.message||"Propuesta de pago anulada")}).catch(e=>{o.hide();this.showMessageBox("error","Error",e.message)})},_deletePaymentSeats:function(e){o.show(0);let t=this.byId("stPropPagosRPA");let s=this.byId("stPagosRPA");n.triggerRequest(this.getAppModel(),e,"ANUL_DOCPAGO").then(e=>{o.hide();t.rebindTable(true);s.rebindTable(true);this.showMessageToast(e.message||"Asiento de pago anulado")}).catch(e=>{o.hide();this.showMessageBox("error","Error",e.message)})}})});