sap.ui.define(["efolder/efol/BSP_SAPMUTILS/controller/BaseController","../util/utils","../service/service","efolder/efol/BSP_SAPMUTILS/service/ServiceExpediente","efolder/efol/BSP_SAPMUTILS/model/CoreModel","efolder/sap/ZACTUACION/controller/fragment/genericListHelp","efolder/sap/ZACTUACION/controller/fragment/genericTableHelp","sap/m/Dialog","sap/m/DialogType","sap/m/Button","sap/m/ButtonType","sap/m/Text"],(function(e,t,o,i,n,s,d,l,r,a,c,g){"use strict";function p(e){u(jQuery.extend(this,[],n.jsonModelAct.getData().Avisos),0,e)}function u(e,t,o){if(e[t]){var i=e[t];if(i._deleteInd)n.odataModelAct.remove("/AvisoSet(Tipex='"+i.Tipex+"',Gjahr='"+i.Gjahr+"',Numex='"+i.Numex+"',CodAviso='"+i.CodAviso+"')",{success:function(i){u(e,t+1,o)},error:function(e){o(e)}});else if(i._isNew){for(var s in i)0===s.indexOf("_")&&(i[s]=void 0);i.AvisoResuelto=i.AvisoResuelto?"X":"",n.odataModelAct.create("/AvisoSet",i,{success:function(i){u(e,t+1,o)}.bind(this),error:function(e){o(e)}})}else{for(var s in i)0===s.indexOf("_")&&(i[s]=void 0);i.AvisoResuelto=i.AvisoResuelto?"X":"",n.odataModelAct.update("/AvisoSet(Tipex='"+i.Tipex+"',Gjahr='"+i.Gjahr+"',Numex='"+i.Numex+"',CodAviso='"+i.CodAviso+"')",i,{success:function(i){u(e,t+1,o)},error:function(e){o(e)}})}}else o()}return e.extend("efolder.sap.ZACTUACION.controller.main",{multiinputFields:[],RequiredFields:["TareaExp","TipoActuacion","FechaInicio","FechaAlta","Zona","Solicitante","FechaFin"],init:function(){n.jsonModelAct?(this.getView().setModel(n.odataModelAct,"odataModelAct"),this.getView().setModel(n.odataModelHelp,"odataModelHelp"),this.getView().setModel(n.jsonModelHelp,"jsonModelHelp"),this.getView().setModel(n.odataModelUCC,"odataModelUCC")):(n.jsonModelAct=new sap.ui.model.json.JSONModel({Avisos:[]}),this.onSubscribeSave(n.jsonModelAct),n.odataModelAct=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZEFOL_ACTUACION_SRV_01/"),this.getView().setModel(n.odataModelAct,"odataModelAct"),n.odataModelAct.sDefaultUpdateMethod="PUT",n.odataModelHelp=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZEFOL_MATCHCODE_SRV_02/"),this.getView().setModel(n.odataModelHelp,"odataModelHelp"),n.jsonModelHelp=new sap.ui.model.json.JSONModel({}),this.getView().setModel(n.jsonModelHelp,"jsonModelHelp"),this.getView().setModel(n.EFOLDER_CABECERA,"EFOLDER_CABECERA"),n.odataModelUCC=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZEFOL_UUCC_SRV/"),this.getView().setModel(n.odataModelUCC,"odataModelUCC"),s.destroyPopup(),s.init(this.getView())),this.getView().setModel(n.jsonModelAct,"jsonModelAct"),this.getView().bindElement("jsonModelAct>/"),this.HeaderIds=this.getHeaderIds();var e=new sap.ui.model.json.JSONModel({edit:"DISPLAY"!==this.HeaderIds.MODE,expandable:!1,currency:"EUR"});this.getView().setModel(e,"oViewModel"),t._flagCall=!0},exit:function(){this.onUnsubscribeSave(n.jsonModelAct)},createModels:function(){},cleanModels:function(){this.HeaderIds=this.getHeaderIds();var e=new sap.ui.model.json.JSONModel({edit:"DISPLAY"!==this.HeaderIds.MODE,expandable:!1,currency:"EUR"});this.getView().setModel(e,"oViewModel"),this.callZexpediente()},callZexpediente:function(){this.getView().getModel("odataModelAct").read("/CabeceraActuacionSet(Tipex='"+this.HeaderIds.Tipex+"',Gjahr='"+this.HeaderIds.Gjahr+"',Numex='"+this.HeaderIds.Numex+"')",{urlParameters:{$expand:"Avisos"},success:function(e){var t=jQuery.sap.extend(!0,{},e);for(var o in t)if(this.multiinputFields.includes(o))if(""===t[o])t[o]=[];else{var i=t[o].split(";");for(var s in t[o]=[],i)t[o].push({id:i[s],text:i[s]})}if(n.jsonModelAct.setData(t),n.jsonModelAct.getData().Avisos){for(var o in t.Avisos.results)t.Avisos.results[o].AvisoResuelto="X"===t.Avisos.results[o].AvisoResuelto;n.jsonModelAct.getData().Avisos=t.Avisos.results}else n.jsonModelAct.getData().Avisos=[];n.jsonModelAct.refresh()}.bind(this),error:function(e){n.jsonModelAct.setData({Tipex:this.HeaderIds.Tipex,Gjahr:this.HeaderIds.Gjahr,Numex:this.HeaderIds.Numex,Recid:this.HeaderIds.Gjahr+"/"+this.HeaderIds.Numex,_isNew:!0,Avisos:[]})}.bind(this)})},refreshData:function(){this.HeaderIds=this.getHeaderIds(),n.jsonModelAct.getProperty("/Tipex")||this.callZexpediente()},getAdditionalRoutes:function(){return["main2"]},genericHelpRequest:function(e,t,o,i,n,d){var l=e.getSource(),r="/ZXEFOL_MATCHCODE_INPUTSet",a="Id",c="Text";i&&(r=i),n&&(a=n),d&&(c=d),s.show(this.getView(),function(e){l.setValue(e.getBindingContext("odataModelHelp").getObject()[a]),l.getBindingInfo("description")&&l.setDescription(e.getBindingContext("odataModelHelp").getObject()[c]),t&&t(e)}.bind(this),r,a,c,"odataModelHelp>",l.data().helpSet,l.data().internalHelpSet,!1,o)},genericHelpRequestProvincia:function(e){var t=e.getSource();n.jsonModelHelp.getProperty("/SH_ProvinciaSet")||n.odataModelHelp.read("/SH_ProvinciaSet",{filters:[new sap.ui.model.Filter("Pais","EQ","ES")],success:function(e){n.jsonModelHelp.setProperty("/SH_ProvinciaSet",e.results),n.jsonModelHelp.setProperty("/SH_ProvinciaSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().CodProvincia),t.setDescription(e.getBindingContext("jsonModelHelp").getObject().DescripProvincia)}.bind(this),"/SH_ProvinciaSet","CodProvincia","DescripProvincia","jsonModelHelp>",void 0,void 0,!1)},onChangeProvincia:function(e){var t=e.getSource(),o=t.getValue();if(o)if(n.jsonModelHelp.getProperty("/SH_ProvinciaSet")){var i=n.jsonModelHelp.getProperty("/SH_ProvinciaSet"),s=!1;for(var d in i)if(i[d].CodProvincia===o){t.setDescription(i[d].DescripProvincia);s=!0;break}s||t.setDescription("")}else n.odataModelHelp.read("/SH_ProvinciaSet",{filters:[new sap.ui.model.Filter("Pais","EQ","ES")],success:function(e){n.jsonModelHelp.setProperty("/SH_ProvinciaSet",e.results),n.jsonModelHelp.setProperty("/SH_ProvinciaSet/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_ProvinciaSet"),s=!1;for(var d in i)if(i[d].CodProvincia===o){t.setDescription(i[d].DescripProvincia);s=!0;break}s||t.setDescription("")}});else t.setDescription("")},genericHelpRequestItem:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_ItemSet",{filters:[new sap.ui.model.Filter("IdInit","EQ",t.data().fieldInit)],success:function(e){n.jsonModelHelp.setProperty("/SH_ItemSet",e.results),n.jsonModelHelp.setProperty("/SH_ItemSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().IdItem),t.getBindingContext("jsonModelAct").getObject()[t.data().desc]=e.getBindingContext("jsonModelHelp").getObject().DescripItem,this.getView().getModel("jsonModelAct").refresh()}.bind(this),"/SH_ItemSet","IdItem","DescripItem","jsonModelHelp>",void 0,void 0,!1)},genericHelpRequestInit:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_InitiativeSet",{filters:[new sap.ui.model.Filter("ParentGuid","EQ",t.getBindingContext("jsonModelAct").getObject().BucketGuid),new sap.ui.model.Filter("GrupoPlanificador","EQ",t.getBindingContext("jsonModelAct").getObject().GrupoPlanificador)],success:function(e){n.jsonModelHelp.setProperty("/SH_InitiativeSet",e.results),n.jsonModelHelp.setProperty("/SH_InitiativeSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.getBindingContext("jsonModelAct").getObject()[t.data().fieldDesc]=e.getBindingContext("jsonModelHelp").getObject().DescripInit,t.getModel("jsonModelAct").refresh(),t.setValue(e.getBindingContext("jsonModelHelp").getObject().IdInit),n.odataModelHelp.read("/SH_ItemSet",{filters:[new sap.ui.model.Filter("IdInit","EQ",t.getValue())],success:function(e){n.jsonModelHelp.setProperty("/SH_ItemSet",e.results),n.jsonModelHelp.setProperty("/SH_ItemSet/noBusy",!0);var o=n.jsonModelHelp.getProperty("/SH_ItemSet");1===o.length?(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]=o[0].IdItem,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]=o[0].DescripItem,t.getModel("jsonModelAct").refresh()):(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]="",t.getModel("jsonModelAct").refresh())}})}.bind(this),"/SH_InitiativeSet","IdInit","DescripInit","jsonModelHelp>",void 0,void 0,!1)},genericHelpRequestAreaEnergetica:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_AreaEnergeticaSet",{filters:[new sap.ui.model.Filter("Zona","EQ",t.data().fieldZona)],success:function(e){n.jsonModelHelp.setProperty("/SH_AreaEnergeticaSet",e.results),n.jsonModelHelp.setProperty("/SH_AreaEnergeticaSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().CodArea)}.bind(this),"/SH_AreaEnergeticaSet","CodArea","CodAviso","jsonModelHelp>",void 0,void 0,!1)},onGenericChange:function(e){var t=e.getSource(),o=t.getValue(),i=t.data().helpSet,s=t.data().internalHelpSet,d=t.getBindingInfo("value").binding.getPath();if(o)if(n.jsonModelHelp.getProperty("/"+d)){var l=n.jsonModelHelp.getProperty("/"+d),r=!1;for(var a in l)if(l[a].Id===o){t.setDescription(l[a].Text);r=!0;break}r||(t.setDescription(""),t.setValue(""))}else n.odataModelHelp.read("/ZXEFOL_MATCHCODE_INPUTSet",{filters:[new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Field","EQ",i),new sap.ui.model.Filter("Text","EQ",""),new sap.ui.model.Filter("Id","EQ",""),new sap.ui.model.Filter("Type","EQ",s),new sap.ui.model.Filter("Validar","EQ","")],and:!0})],success:function(e){n.jsonModelHelp.setProperty("/"+d,e.results),n.jsonModelHelp.setProperty("/"+d+"/noBusy",!0);var i=n.jsonModelHelp.getProperty("/"+d),s=!1;for(var l in i)if(i[l].Id===o){t.setDescription(i[l].Text);s=!0;break}s||(t.setDescription(""),t.setValue(""))}});else t.setDescription("")},genericHelpRequestMultiSelect:function(e,t,o){var i=e.getSource();s.show(this.getView(),function(e){var t=i.getAggregation("tokenizer").getBindingInfo("tokens").path;for(var o in i.getModel("jsonModelAct").setProperty(t,[]),e){var s=e[o].getBindingContext("odataModelHelp").getObject();i.getModel("jsonModelAct").getProperty(t).push({id:s.Id,text:s.Id})}i.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange()}.bind(this),"/ZXEFOL_MATCHCODE_INPUTSet","Id","Text","odataModelHelp>",i.data().helpSet,i.data().internalHelpSet,!0);var d=i.getAggregation("tokenizer").getBindingInfo("tokens").path;s.setSelectedValuesMultiSelect(i.getModel("jsonModelAct").getProperty(d))},genericHelpRequestMultiSelectAreaE:function(e){var t=e.getSource(),o=t.getModel("jsonModelAct").getProperty("/Avisos"),i=[];for(var d in o)i.push({CodAviso:o[d].CodAviso});var l=[new sap.ui.model.Filter("CodAviso","EQ",JSON.stringify(i))];s.show(this.getView(),function(e){var o=t.getAggregation("tokenizer").getBindingInfo("tokens").path;for(var i in t.getModel("jsonModelAct").setProperty(o,[]),e){var s=e[i].getBindingContext("odataModelHelp").getObject();t.getModel("jsonModelAct").getProperty(o).push({id:s.Id,text:s.Id})}t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange()}.bind(this),"/SH_AreaEnergeticaSet","CodArea","CodArea","odataModelHelp>",void 0,void 0,!0,l);var r=t.getAggregation("tokenizer").getBindingInfo("tokens").path;s.setSelectedValuesMultiSelect(t.getModel("jsonModelAct").getProperty(r))},navAvisoInfo:function(e){var t=e.getSource().getBindingContext("jsonModelAct").getObject().CodAviso,o=sap.ushell.Container.getService("CrossApplicationNavigation"),i=o&&o.hrefForExternal({target:{semanticObject:"Z_IW23",action:"display"},params:{NotifNo:t}})||"",n=window.location.href.split("#")[0]+i;sap.m.URLHelper.redirect(n,!0)},dataChange:function(e){var t=e.getSource(),o=this;this.oApproveDialog||(this.oApproveDialog=new l({type:r.Message,title:"Confirmar",content:new g({text:"{i18n>DeseaSobreEscribir}"}),beginButton:new a({type:c.Emphasized,text:"Aceptar",press:function(){n.odataModelHelp.read("/SH_AvisoSet('"+t.getBindingContext("jsonModelAct").getObject().CodAviso+"')",{success:function(e){var i=t.getModel("jsonModelAct").getData();for(var s in e)void 0!==i[s]&&(i[s]=e[s]);n.jsonModelAct.refresh(),n.jsonModelAct.firePropertyChange(),o.oApproveDialog.destroy(),o.oApproveDialog=null},error:function(){o.oApproveDialog.destroy(),o.oApproveDialog=null}})}.bind(this)}),endButton:new a({text:"Cancelar",press:function(){this.oApproveDialog.destroy(),this.oApproveDialog=null}.bind(this)})}),this.getView().addDependent(this.oApproveDialog)),this.oApproveDialog.open()},genericHelpRequestCodAviso:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_AvisoSet",{filters:[new sap.ui.model.Filter("TipoActuacionF","EQ",t.getModel("jsonModelAct").getProperty("/TipoActuacion"))],success:function(e){n.jsonModelHelp.setProperty("/SH_AvisoSet",e.results),n.jsonModelHelp.setProperty("/SH_AvisoSet/noBusy",!0)}}),s.show(this.getView(),function(e){var o=e.getBindingContext("jsonModelHelp").getObject(),i=t.getBindingContext("jsonModelAct").getObject();t.setValue(o.CodAviso),i.Descaviso=o.Descaviso,i.ClaseAviso=o.ClaseAviso,i.UbicacionTec=o.UbicacionTec,i.Equipo=o.Equipo,i.DescUbicacion=o.DescUbicacion,i.DescEquipo=o.DescEquipo,t.getModel("jsonModelAct").refresh()}.bind(this),"/SH_AvisoSet","CodAviso","Descaviso","jsonModelHelp>",void 0,void 0,!1)},onChangeCodAviso:function(e){var t=e.getSource(),o=t.getValue(),i=t.getBindingContext("jsonModelAct").getObject();if(o)if(n.jsonModelHelp.getProperty("/SH_AvisoSet")){var s=n.jsonModelHelp.getProperty("/SH_AvisoSet"),d=!1;for(var l in s)if(s[l].CodAviso===o){i.Descaviso=s[l].Descaviso,i.ClaseAviso=s[l].ClaseAviso,i.UbicacionTec=s[l].UbicacionTec,i.Equipo=s[l].Equipo,i.DescUbicacion=s[l].DescUbicacion,i.DescEquipo=s[l].DescEquipo,t.getModel("jsonModelAct").refresh();d=!0;break}d||(i.Descaviso="",i.ClaseAviso="",i.UbicacionTec="",i.Equipo="",i.DescUbicacion="",i.DescEquipo="",t.getModel("jsonModelAct").refresh())}else n.odataModelHelp.read("/SH_AvisoSet",{filters:[new sap.ui.model.Filter("Pais","EQ","ES")],success:function(e){n.jsonModelHelp.setProperty("/SH_AvisoSet",e.results),n.jsonModelHelp.setProperty("/SH_AvisoSet/noBusy",!0);var s=n.jsonModelHelp.getProperty("/SH_AvisoSet"),d=!1;for(var l in s)if(s[l].CodAviso===o){i.Descaviso=s[l].Descaviso,i.ClaseAviso=s[l].ClaseAviso,i.UbicacionTec=s[l].UbicacionTec,i.Equipo=s[l].Equipo,i.DescUbicacion=s[l].DescUbicacion,i.DescEquipo=s[l].DescEquipo,t.getModel("jsonModelAct").refresh();d=!0;break}d||(i.Descaviso="",i.ClaseAviso="",i.UbicacionTec="",i.Equipo="",i.DescUbicacion="",i.DescEquipo="",t.getModel("jsonModelAct").refresh())}});else i.Descaviso="",i.ClaseAviso="",i.UbicacionTec="",i.Equipo="",i.DescUbicacion="",i.DescEquipo="",t.getModel("jsonModelAct").refresh()},addAviso:function(){this.getView().getModel("jsonModelAct").getProperty("/Avisos").push({Tipex:n.EFOLDER_CABECERA.getProperty("/Tipex"),Gjahr:n.EFOLDER_CABECERA.getProperty("/Gjahr"),Numex:n.EFOLDER_CABECERA.getProperty("/Numex"),_id:this.getView().getModel("jsonModelAct").getProperty("/Avisos").length,_isNew:!0,AvisoResuelto:!0}),this.getView().getModel("jsonModelAct").refresh()},deleteAviso:function(e){var t=e.getSource().getBindingContext("jsonModelAct").getObject();if(t.CodAviso)t._deleteInd=!0;else{var o=this.getView().getModel("jsonModelAct").getProperty("/Avisos");for(var i in o)if(o[i]._id===t._id){o.splice(i,1);break}}this.getView().getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange()},navAviso:function(e){},saveData:function(){var e=this.multiinputFields;return this.RequiredFields,new Promise((function(o,i){if(t._flagCall){t._flagCall=!1;var s=jQuery.extend(this,{},n.jsonModelAct.getData()),d=!1;for(var l in s._isNew&&(d=!0),s){if(0===l.indexOf("_")&&(s[l]=void 0),e.includes(l)){var r="";for(var a in s[l])""!==r&&(r+=";"),r+=s[l][a].id;s[l]=r}"FechaPrevIni"!==l&&"FechaPrevFin"!==l||s[l]&&s[l].setMinutes(s[l].getMinutes()-s[l].getTimezoneOffset()),"PresupuestoDisenio"!==l&&"PresupuestoTramit"!==l&&"PresupuestoEjec"!==l&&"PresupuestoTotal"!==l||(s[l]=s[l]+"")}s.Avisos=void 0,d?n.odataModelAct.create("/CabeceraActuacionSet",s,{success:function(e){p((function(){o(e)})),t._flagCall=!0}.bind(this),error:function(e){i(e),t._flagCall=!0}.bind(this)}):n.odataModelAct.update("/CabeceraActuacionSet(Tipex='"+n.EFOLDER_CABECERA.getProperty("/Tipex")+"',Gjahr='"+n.EFOLDER_CABECERA.getProperty("/Gjahr")+"',Numex='"+n.EFOLDER_CABECERA.getProperty("/Numex")+"')",s,{success:function(e){p((function(t){t?i(t):o(e)})),t._flagCall=!0}.bind(this),error:function(e){i(e),t._flagCall=!0}.bind(this)})}else o()}))},updateToken:function(e){var t=e.getParameters().removedTokens;for(var o in t){var i=t[o].getBindingContext("jsonModelAct").getPath().split("/");t[o].getBindingContext("jsonModelAct").getModel().getProperty("/"+i[1]).splice(i[2],1)}e.getSource().getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange()},addToken:function(e){return!0},changeToken:function(e){var t=e.getParameters().newValue,o=e.getSource().getAggregation("tokenizer").getBindingInfo("tokens").path;e.getSource().getModel("jsonModelAct").getProperty(o).push({id:t,text:t}),e.getSource().getModel("jsonModelAct").refresh(),e.getSource().setValue(""),n.jsonModelAct.firePropertyChange()},onChangeInit:function(e){var t=e.getSource();t.getValue()?n.odataModelHelp.read("/SH_InitiativeSet",{filters:[new sap.ui.model.Filter("ParentGuid","EQ",t.getBindingContext("jsonModelAct").getObject().BucketGuid),new sap.ui.model.Filter("GrupoPlanificador","EQ",t.getBindingContext("jsonModelAct").getObject().GrupoPlanificador)],success:function(e){n.jsonModelHelp.setProperty("/SH_InitiativeSet",e.results),n.jsonModelHelp.setProperty("/SH_InitiativeSet/noBusy",!0);e=n.jsonModelHelp.getProperty("/SH_InitiativeSet");var o=!1;for(var i in e)if(e[i].IdInit===t.getValue()){o=!0,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldDesc]=e[i].DescripInit,n.odataModelHelp.read("/SH_ItemSet",{filters:[new sap.ui.model.Filter("IdInit","EQ",t.getValue())],success:function(e){n.jsonModelHelp.setProperty("/SH_ItemSet",e.results),n.jsonModelHelp.setProperty("/SH_ItemSet/noBusy",!0);var o=n.jsonModelHelp.getProperty("/SH_ItemSet");1===o.length?(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]=o[0].IdItem,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]=o[0].DescripItem,t.getModel("jsonModelAct").refresh()):(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]="",t.getModel("jsonModelAct").refresh())}}),t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange();break}o||(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange())}}):(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange())},onChangeItem:function(e){var t=e.getSource();if(t.getValue())if(n.jsonModelHelp.getProperty("/SH_ItemSet")){var o=n.jsonModelHelp.getProperty("/SH_ItemSet"),i=!1;for(var s in o)if(o[s].IdItem===t.getValue()){i=!0,t.getBindingContext("jsonModelAct").getObject()[t.data().desc]=o[s].DescripItem,t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange();break}i||(t.getBindingContext("jsonModelAct").getObject()[t.data().desc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange())}else n.odataModelHelp.read("/SH_ItemSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_ItemSet",e.results),n.jsonModelHelp.setProperty("/SH_ItemSet/noBusy",!0);e=n.jsonModelHelp.getProperty("/SH_ItemSet");var o=!1;for(var i in e)if(e[i].IdItem===t.getValue()){o=!0,t.getBindingContext("jsonModelAct").getObject()[t.data().desc]=e[i].DescripItem,t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange();break}o||(t.getBindingContext("jsonModelAct").getObject()[t.data().desc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange())}});else t.getBindingContext("jsonModelAct").getObject()[t.data().desc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange()},genericHelpRequestLocal:function(e,t,o,i,d,l){var r=e.getSource(),a=r.data().helpSet,c=r.data().internalHelpSet,g=r.getBindingInfo("value").binding.getPath();n.jsonModelHelp.getProperty("/"+g)||n.odataModelHelp.read("/ZXEFOL_MATCHCODE_INPUTSet",{filters:[new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Field","EQ",a),new sap.ui.model.Filter("Text","EQ",""),new sap.ui.model.Filter("Id","EQ",""),new sap.ui.model.Filter("Type","EQ",c),new sap.ui.model.Filter("Validar","EQ","")],and:!0})],success:function(e){n.jsonModelHelp.setProperty("/"+g,e.results),n.jsonModelHelp.setProperty("/"+g+"/noBusy",!0)}}),s.show(this.getView(),function(e){r.setValue(e.getBindingContext("jsonModelHelp").getObject().Id),r.getBindingInfo("description")&&r.setDescription(e.getBindingContext("jsonModelHelp").getObject().Text),t&&t(e)}.bind(this),"/"+g,"Id","Text","jsonModelHelp>",void 0,void 0,!1)},genericHelpRequestPuestoTrabajo:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_PuestoTbjoSet",{filters:[new sap.ui.model.Filter("Zona","EQ",t.getModel("jsonModelAct").getProperty("/Zona"))],success:function(e){n.jsonModelHelp.setProperty("/SH_PuestoTbjoSet",e.results),n.jsonModelHelp.setProperty("/SH_PuestoTbjoSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().CodPuesto),t.getBindingInfo("description")&&t.setDescription(e.getBindingContext("jsonModelHelp").getObject().DescripPuesto),callback&&callback(e)}.bind(this),"/SH_PuestoTbjoSet","CodPuesto","DescripPuesto","jsonModelHelp>",void 0,void 0,!1)},genericHelpRequestZona:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_ZonaSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_ZonaSet",e.results),n.jsonModelHelp.setProperty("/SH_ZonaSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().Zona),t.getBindingInfo("description")&&t.setDescription(e.getBindingContext("jsonModelHelp").getObject().DescripZona),callback&&callback(e)}.bind(this),"/SH_ZonaSet","Zona","DescripZona","jsonModelHelp>",void 0,void 0,!1)},genericHelpRequestDelegacion:function(e){var t=e.getSource();""!==t.getModel("jsonModelAct").getProperty("/Zona")?n.odataModelHelp.read("/SH_DelegacionSet",{filters:[new sap.ui.model.Filter("Zona","EQ",t.getModel("jsonModelAct").getProperty("/Zona"))],success:function(e){n.jsonModelHelp.setProperty("/SH_DelegacionSet",e.results),n.jsonModelHelp.setProperty("/SH_DelegacionSet/noBusy",!0)}}):n.odataModelHelp.read("/SH_DelegacionSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_DelegacionSet",e.results),n.jsonModelHelp.setProperty("/SH_DelegacionSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().Delegacion),t.getBindingInfo("description")&&t.setDescription(e.getBindingContext("jsonModelHelp").getObject().DescripDelegacion),callback&&callback(e)}.bind(this),"/SH_DelegacionSet","Delegacion","DescripDelegacion","jsonModelHelp>",void 0,void 0,!1)},onChangeZona:function(e){var t=e.getSource(),o=t.getValue();if(o)if(n.jsonModelHelp.getProperty("/SH_ZonaSet")){var i=n.jsonModelHelp.getProperty("/SH_ZonaSet"),s=!1;for(var d in i)if(i[d].Zona===o){t.setDescription(i[d].DescripZona);s=!0;break}s||t.setDescription("")}else n.odataModelHelp.read("/SH_ZonaSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_ZonaSet",e.results),n.jsonModelHelp.setProperty("/SH_ZonaSet/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_ZonaSet"),s=!1;for(var d in i)if(i[d].Zona===o){t.setDescription(i[d].DescripZona);s=!0;break}s||t.setDescription("")}});else t.setDescription("")},onChangeDelegacion:function(e){var t=e.getSource(),o=t.getValue();if(o)if(n.jsonModelHelp.getProperty("/SH_DelegacionSet")){var i=n.jsonModelHelp.getProperty("/SH_DelegacionSet"),s=!1;for(var d in i)if(i[d].Delegacion===o){t.setDescription(i[d].DescripDelegacion);s=!0;break}s||t.setDescription("")}else""!==t.getModel("jsonModelAct").getProperty("/Zona")?n.odataModelHelp.read("/SH_DelegacionSet",{filters:[new sap.ui.model.Filter("Zona","EQ",t.getModel("jsonModelAct").getProperty("/Zona"))],success:function(e){n.jsonModelHelp.setProperty("/SH_DelegacionSet",e.results),n.jsonModelHelp.setProperty("/SH_DelegacionSet/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_DelegacionSet"),s=!1;for(var d in i)if(i[d].Delegacion===o){t.setDescription(i[d].DescripDelegacion);s=!0;break}s||t.setDescription("")}}):n.odataModelHelp.read("/SH_DelegacionSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_DelegacionSet",e.results),n.jsonModelHelp.setProperty("/SH_DelegacionSet/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_DelegacionSet"),s=!1;for(var d in i)if(i[d].Delegacion===o){t.setDescription(i[d].DescripDelegacion);s=!0;break}s||t.setDescription("")}});else t.setDescription("")},onChangePesupuesto:function(e){var t=this.getView().getModel("jsonModelAct").getData(),o=t.PresupuestoDisenio,i=t.PresupuestoTramit,n=t.PresupuestoEjec;this.getView().getModel("jsonModelAct").getData().PresupuestoTotal=parseFloat(o)+parseFloat(i)+parseFloat(n),this.getView().getModel("jsonModelAct").refresh()},genericHelpRequestPrioridad:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_PrioridadSet",{filters:[new sap.ui.model.Filter("ClasePrioridad","EQ",t.getModel("jsonModelAct").getProperty("/ClasePrioridad"))],success:function(e){n.jsonModelHelp.setProperty("/SH_PrioridadSet",e.results),n.jsonModelHelp.setProperty("/SH_PrioridadSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().Prioridad),t.getBindingInfo("description")&&t.setDescription(e.getBindingContext("jsonModelHelp").getObject().DescrPrioridad),callback&&callback(e)}.bind(this),"/SH_PrioridadSet","Prioridad","DescrPrioridad","jsonModelHelp>",void 0,void 0,!1)},onChangePrioridad:function(e){var t=e.getSource(),o=t.getValue();if(o)if(n.jsonModelHelp.getProperty("/SH_PrioridadSet")){var i=n.jsonModelHelp.getProperty("/SH_PrioridadSet"),s=!1;for(var d in i)if(i[d].Prioridad===o){t.setDescription(i[d].DescrPrioridad);s=!0;break}s||t.setDescription("")}else n.odataModelHelp.read("/SH_PrioridadSet",{filters:[new sap.ui.model.Filter("ClasePrioridad","EQ",t.getModel("jsonModelAct").getProperty("/ClasePrioridad"))],success:function(e){n.jsonModelHelp.setProperty("/SH_PrioridadSet",e.results),n.jsonModelHelp.setProperty("/SH_PrioridadSet/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_PrioridadSet"),s=!1;for(var d in i)if(i[d].Prioridad===o){t.setDescription(i[d].DescrPrioridad);s=!0;break}s||t.setDescription("")}});else t.setDescription("")},genericHelpRequestTable:function(e){var t=e.getSource();d.show(this.getView(),function(e){t.setValue(e.getBindingContext("odataModelUCC").getObject().CuId),t.setDescription(e.getBindingContext("odataModelUCC").getObject().Cutxt)}.bind(this),"/UnidadCompatibleSet","odataModelUCC>",["Cutyp","CuId","Cutxt","CuType","Vtext","PrSer","PrMat"])},genericHelpRequestUnidadSolicitante:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_UnidadSolicitanteSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_UnidadSolicitanteSet",e.results),n.jsonModelHelp.setProperty("/SH_UnidadSolicitanteSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().UnidadOrganizativa),callback&&callback(e)}.bind(this),"/SH_UnidadSolicitanteSet","UnidadOrganizativa","dummy","jsonModelHelp>",void 0,void 0,!1)},genericHelpRequestMunicipio:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_MunicipioSet",{filters:[new sap.ui.model.Filter("Provincia","EQ",t.getBindingContext("jsonModelAct").getObject().CodProvincia)],success:function(e){n.jsonModelHelp.setProperty("/SH_MunicipioSet",e.results),n.jsonModelHelp.setProperty("/SH_MunicipioSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().Municipio),t.setDescription(e.getBindingContext("jsonModelHelp").getObject().Descripcion)}.bind(this),"/SH_MunicipioSet","Municipio","Descripcion","jsonModelHelp>",void 0,void 0,!1)},onChangeMunicipio:function(e){var t=e.getSource(),o=t.getValue();o?n.odataModelHelp.read("/SH_MunicipioSet",{filters:[new sap.ui.model.Filter("Provincia","EQ",t.getBindingContext("jsonModelAct").getObject().CodProvincia)],success:function(e){n.jsonModelHelp.setProperty("/SH_MunicipioSet",e.results),n.jsonModelHelp.setProperty("/SH_MunicipioSet/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_MunicipioSet"),s=!1;for(var d in i)if(i[d].Municipio===o){t.setDescription(i[d].Descripcion);s=!0;break}s||t.setDescription("")}}):t.setDescription("")},genericHelpRequestCodPostal:function(e){var t=e.getSource();""!==t.getModel("jsonModelAct").getProperty("/CodMunicipio")?n.odataModelHelp.read("/SH_CodPostalSet",{filters:[new sap.ui.model.Filter("CodMuni","EQ",t.getModel("jsonModelAct").getProperty("/CodMunicipio"))],success:function(e){n.jsonModelHelp.setProperty("/SH_CodPostalSet",e.results),n.jsonModelHelp.setProperty("/SH_CodPostalSet/noBusy",!0)}}):n.odataModelHelp.read("/SH_CodPostalSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_CodPostalSet",e.results),n.jsonModelHelp.setProperty("/SH_CodPostalSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().CodPostal)}.bind(this),"/SH_CodPostalSet","CodPostal","CodMuni","jsonModelHelp>",void 0,void 0,!1)},onChangeTipoActuacion:function(e){var t=e.getSource(),o=t.getValue();if(o)if(n.jsonModelHelp.getProperty("/SH_TipoActuacionSet")){var i=n.jsonModelHelp.getProperty("/SH_TipoActuacionSet"),s=!1;for(var d in i)if(i[d].TipoActuacion===o){t.setDescription(i[d].DescripcionTipoActu);s=!0;break}s||t.setDescription("")}else n.odataModelHelp.read("/SH_TipoActuacionSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_TipoActuacionSet",e.results),n.jsonModelHelp.setProperty("/SH_TipoActuacionSet/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_TipoActuacionSet"),s=!1;for(var d in i)if(i[d].TipoActuacion===o){t.setDescription(i[d].DescripcionTipoActu);s=!0;break}s||t.setDescription("")}});else t.setDescription("")},genericHelpRequestTipoActuacion:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_TipoActuacionSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_TipoActuacionSet",e.results),n.jsonModelHelp.setProperty("/SH_TipoActuacionSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().TipoActuacion),t.setDescription(e.getBindingContext("jsonModelHelp").getObject().DescripcionTipoActu)}.bind(this),"/SH_TipoActuacionSet","TipoActuacion","DescripcionTipoActu","jsonModelHelp>",void 0,void 0,!1)},onChangeBucket:function(e){var t=e.getSource();t.getValue()?n.odataModelHelp.read("/SH_InitiativeSet",{filters:[new sap.ui.model.Filter("ParentGuid","EQ",t.getBindingContext("jsonModelAct").getObject().BucketGuid),new sap.ui.model.Filter("GrupoPlanificador","EQ",t.getBindingContext("jsonModelAct").getObject().GrupoPlanificador)],success:function(e){n.jsonModelHelp.setProperty("/SH_InitiativeSet",e.results),n.jsonModelHelp.setProperty("/SH_InitiativeSet/noBusy",!0);var o=n.jsonModelHelp.getProperty("/SH_InitiativeSet");1===o.length?(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldInitId]=o[0].IdInit,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldInitDesc]=o[0].DescripInit,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeIniId]=o[0].IdInit,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeIniDesc]=o[0].DescripInit,n.odataModelHelp.read("/SH_ItemSet",{filters:[new sap.ui.model.Filter("IdInit","EQ",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldInitId])],success:function(e){n.jsonModelHelp.setProperty("/SH_ItemSet",e.results),n.jsonModelHelp.setProperty("/SH_ItemSet/noBusy",!0);var o=n.jsonModelHelp.getProperty("/SH_ItemSet");1===o.length?(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]=o[0].IdItem,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]=o[0].DescripItem,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemId]=o[0].IdItem,t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemDesc]=o[0].DescripItem,t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange()):(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemDesc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange())}})):(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldInitId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldInitDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeIniId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeIniDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemDesc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange())}}):(t.getBindingContext("jsonModelAct").getObject()[t.data().fieldInitId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldInitDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldItemDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeIniId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeIniDesc]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemId]="",t.getBindingContext("jsonModelAct").getObject()[t.data().fieldEjeItemDesc]="",t.getModel("jsonModelAct").refresh(),n.jsonModelAct.firePropertyChange())},genericHelpRequestDistrito:function(e){var t=e.getSource();n.jsonModelHelp.getProperty("/SH_DistritoSet")||n.odataModelHelp.read("/SH_DistritoSet",{success:function(e){n.jsonModelHelp.setProperty("/SH_DistritoSet",e.results),n.jsonModelHelp.setProperty("/SH_DistritoSet/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().Descripcion)}.bind(this),"/SH_DistritoSet","Codigo","Descripcion","jsonModelHelp>",void 0,void 0,!1)},genericHelpRequestClaseActividad:function(e){var t=e.getSource();n.odataModelHelp.read("/SH_ClaseActividad",{filters:[new sap.ui.model.Filter("TipoActuacion","EQ",t.getModel("jsonModelAct").getProperty("/TipoActuacion"))],success:function(e){n.jsonModelHelp.setProperty("/SH_ClaseActividad",e.results),n.jsonModelHelp.setProperty("/SH_ClaseActividad/noBusy",!0)}}),s.show(this.getView(),function(e){t.setValue(e.getBindingContext("jsonModelHelp").getObject().ClaseActividad),t.getModel("jsonModelAct").setProperty("/DescripClaseActividad",e.getBindingContext("jsonModelHelp").getObject().Descripcion),n.jsonModelAct.refresh()}.bind(this),"/SH_ClaseActividad","ClaseActividad","Descripcion","jsonModelHelp>",void 0,void 0,!1)},onChangeClaseActividad:function(e){var t=e.getSource(),o=t.getValue();o?n.odataModelHelp.read("/SH_ClaseActividad",{filters:[new sap.ui.model.Filter("TipoActuacion","EQ",t.getModel("jsonModelAct").getProperty("/TipoActuacion"))],success:function(e){n.jsonModelHelp.setProperty("/SH_ClaseActividad",e.results),n.jsonModelHelp.setProperty("/SH_ClaseActividad/noBusy",!0);var i=n.jsonModelHelp.getProperty("/SH_ClaseActividad"),s=!1;for(var d in i)if(i[d].ClaseActividad===o){t.getModel("jsonModelAct").setProperty("/DescripClaseActividad",i[d].Descripcion);s=!0;break}s||(t.setValue(""),t.getModel("jsonModelAct").setProperty("/DescripClaseActividad",""))}}):(t.setValue(""),t.getModel("jsonModelAct").setProperty("/DescripClaseActividad",""))},navDocu:function(e){new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZEFOL_DOCUMENTACION_SRV/").read("/DocConsSet(Tipex='"+this.HeaderIds.Tipex+"',Gjahr='"+this.HeaderIds.Gjahr+"',Numex='"+this.HeaderIds.Numex+"')",{success:function(e){window.open(e.Url)}.bind(this),error:function(e){}.bind(this)})}})}));